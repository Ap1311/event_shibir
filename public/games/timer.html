<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Timer & Stopwatch</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <style>
        body {
            background-color: #212529;
            color: #f8f9fa;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            text-align: center;
        }

        .timer-container {
            width: 90%;
            max-width: 600px;
        }

        #display {
            font-size: 10rem;
            font-weight: 300;
            line-height: 1;
            margin-bottom: 2rem;
            color: #fff;
            font-family: 'Roboto Mono', monospace, sans-serif;
        }

        /* Flashing effect for countdown end */
        .flashing {
            animation: flash 0.5s infinite alternate;
        }

        @keyframes flash {
            from { color: #fff; }
            to { color: #dc3545; }
        }

        .btn-group, .stopwatch-controls {
            margin-bottom: 1rem;
        }
        
        .btn-xl {
            padding: 1rem 1.5rem;
            font-size: 1.25rem;
            border-radius: 0.5rem;
        }

        .btn-gray {
            background-color: #495057;
            color: #fff;
            border-color: #495057;
        }
        .btn-gray:hover {
            background-color: #6c757d;
            border-color: #6c757d;
            color: #fff;
        }
    </style>
</head>
<body>

    <div class="timer-container">
        
        <h1 id="display">00:00</h1>
        
        <div class="mb-3">
            <h5>Countdown Presets</h5>
            <div class="btn-group" role="group" aria-label="Countdown Timers">
                <button type="button" class="btn btn-primary btn-lg" data-time="30">30s</button>
                <button type="button" class="btn btn-primary btn-lg" data-time="40">40s</button>
                <button type="button" class="btn btn-primary btn-lg" data-time="45">45s</button>
                <button type="button" class="btn btn-primary btn-lg" data-time="50">50s</button>
                <button type="button" class="btn btn-primary btn-lg" data-time="60">60s</button>
            </div>
        </div>

        <div class="mb-3">
            <h5>Stopwatch</h5>
            <div class="btn-group stopwatch-controls" role="group" aria-label="Stopwatch Controls">
                <button type="button" class="btn btn-success btn-lg" id="startBtn">
                    <i class="bi bi-play-fill"></i> Start
                </button>
                <button type="button" class="btn btn-warning btn-lg" id="stopBtn">
                    <i class="bi bi-pause-fill"></i> Stop
                </button>
                <button type="button" class="btn btn-gray btn-lg" id="resetBtn">
                    <i class="bi bi-arrow-counterclockwise"></i> Reset
                </button>
            </div>
        </div>

        <hr class="text-secondary">
        <button type="button" class="btn btn-danger btn-xl w-100" id="masterStopBtn">
            <i class="bi bi-stop-circle-fill"></i> STOP / RESET ALL
        </button>

    </div>
    
    <audio id="alarmSound" src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg" preload="auto"></audio>


    <script>
        const display = document.getElementById('display');
        const alarmSound = document.getElementById('alarmSound');
        
        const countdownButtons = document.querySelectorAll('[data-time]');
        const startBtn = document.getElementById('startBtn');
        const stopBtn = document.getElementById('stopBtn');
        const resetBtn = document.getElementById('resetBtn');
        const masterStopBtn = document.getElementById('masterStopBtn');

        let timerInterval = null; // Holds the setInterval ID
        let timerMode = null; // 'countdown' or 'stopwatch'
        
        // --- Countdown State ---
        let countdownEndTime = 0;
        
        // --- Stopwatch State ---
        let stopwatchStartTime = 0;
        let stopwatchElapsedTime = 0;
        let stopwatchRunning = false;
        
        
        /**
         * Clears all running intervals and resets the state.
         */
        function stopAndResetAll() {
            clearInterval(timerInterval);
            timerInterval = null;
            timerMode = null;
            
            // Reset stopwatch
            stopwatchRunning = false;
            stopwatchElapsedTime = 0;
            
            // Reset countdown
            countdownEndTime = 0;
            display.classList.remove('flashing');
            
            // Reset display
            display.textContent = '00:00';
            
            // Stop and reset audio
            alarmSound.pause();
            alarmSound.currentTime = 0;
        }
        
        /**
         * Formats milliseconds into MM:SS.s for stopwatch
         */
        function formatStopwatch(ms) {
            let totalSeconds = Math.floor(ms / 1000);
            let minutes = Math.floor(totalSeconds / 60).toString().padStart(2, '0');
            let seconds = (totalSeconds % 60).toString().padStart(2, '0');
            let tenths = Math.floor((ms % 1000) / 100).toString();
            return `${minutes}:${seconds}.${tenths}`;
        }
        
        /**
         * Formats total seconds into MM:SS for countdown
         */
        function formatCountdown(totalSeconds) {
            let minutes = Math.floor(totalSeconds / 60).toString().padStart(2, '0');
            let seconds = (totalSeconds % 60).toString().padStart(2, '0');
            return `${minutes}:${seconds}`;
        }
        
        /**
         * The main loop for the stopwatch.
         */
        function updateStopwatch() {
            const now = Date.now();
            const elapsed = stopwatchElapsedTime + (now - stopwatchStartTime);
            display.textContent = formatStopwatch(elapsed);
        }

        /**
         * The main loop for the countdown.
         */
        function updateCountdown() {
            const now = Date.now();
            const remainingMs = countdownEndTime - now;
            
            if (remainingMs <= 0) {
                display.textContent = '00:00';
                display.classList.add('flashing');
                alarmSound.play();
                clearInterval(timerInterval);
                timerInterval = null;
                timerMode = null;
                return;
            }
            
            // Use Math.ceil to ensure it shows '00:01' until it hits zero
            const remainingSeconds = Math.ceil(remainingMs / 1000);
            display.textContent = formatCountdown(remainingSeconds);
        }

        // --- Event Listeners ---

        // Master Stop Button
        masterStopBtn.addEventListener('click', stopAndResetAll);

        // Countdown Preset Buttons
        countdownButtons.forEach(button => {
            button.addEventListener('click', () => {
                stopAndResetAll();
                timerMode = 'countdown';
                
                const seconds = parseInt(button.dataset.time, 10);
                countdownEndTime = Date.now() + (seconds * 1000);
                
                display.textContent = formatCountdown(seconds); // Show initial time
                timerInterval = setInterval(updateCountdown, 100); // Update frequently
            });
        });
        
        // Stopwatch Start
        startBtn.addEventListener('click', () => {
            if (timerMode === 'countdown' || stopwatchRunning) {
                return; // Don't start if a countdown is running or already started
            }
            
            stopAndResetAll(); // Clear any previous '00:00' state
            timerMode = 'stopwatch';
            stopwatchRunning = true;
            
            // If starting from a paused state, adjust start time
            stopwatchStartTime = Date.now() - stopwatchElapsedTime;
            
            timerInterval = setInterval(updateStopwatch, 100); // Update every 100ms
        });
        
        // Stopwatch Stop
        stopBtn.addEventListener('click', () => {
            if (timerMode !== 'stopwatch' || !stopwatchRunning) {
                return; // Can only stop a running stopwatch
            }
            
            stopwatchRunning = false;
            clearInterval(timerInterval);
            timerInterval = null;
            
            // Store the elapsed time up to this point
            stopwatchElapsedTime = Date.now() - stopwatchStartTime;
            display.textContent = formatStopwatch(stopwatchElapsedTime); // Show final stopped time
        });
        
        // Stopwatch Reset
        resetBtn.addEventListener('click', () => {
            stopAndResetAll();
        });

    </script>
</body>
</html>